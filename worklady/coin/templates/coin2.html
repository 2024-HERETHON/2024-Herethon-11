{% load static %}
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>코인 구매하기</title>
    <!-- CSS 파일 불러오기 -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/coin2.css' %}" />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet" />
    <!-- 모바일 크기 적용 -->
    <style>
      body {
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: flex-start;
        align-items: flex-start;
        min-height: 100vh;
        background-color: #efefef;
        font-family: "Inter", sans-serif; /* Google Fonts 적용 */
      }

      article {
        width: 393px;
        height: 1048px;
        background-color: #ffffff;
        border-radius: 10px;
        position: relative;
        top: 0;
        left: 0;
        margin: 20px; /* 여백 추가 */
      }

      /* 추가적인 스타일링은 coin2.css 파일에 작성 */
    </style>
  </head>
  <body>
    <article>
      <header>
        <div class="time_bar">
          <img src="{% static 'img/time_bar.svg' %}" alt="최상단바" />
        </div>
        <div class="title_box">
          <div class="menu_bar">
            <img src="{% static 'img/menu.svg' %}" alt="메뉴바" />
          </div>
          <div class="logo">
            <img src="{% static 'img/logo_full.png' %}" alt="로고" />
          </div>
          <div class="mypage">
            <img src="{% static 'img/person.svg' %}" alt="마이페이지" />
          </div>
        </div>
        <div class="shadow_line"></div>
        <div class="subtitle_box">
          <button class="menu" id="menu1">프로필 등록</button>
          <button class="menu" id="menu2">프로필 보기</button>
          <button class="menu" id="menu3">멘토 Q&A</button>
        </div>
        <div class="shadow_line"></div>
      </header>
      <div class="main">
        <div class="mycoin">
          <div class="title">코인을 구매하고 질문을 이어나가보세요.</div>
          <div class="coin_box" onclick="selectCoinOption(10, 5000)">
            <div class="coin">
              <img src="{% static 'img/pupple_coin_bold.svg' %}" alt="코인아이콘" />
              10
            </div>
            <div class="text">
              <div class="number">1회 질문 가능</div>
              <div class="money">5,000원</div>
            </div>
          </div>
          <div class="coin_box" onclick="selectCoinOption(20, 12000)">
            <div class="coin">
              <img src="{% static 'img/pupple_coin_bold.svg' %}" alt="코인아이콘" />
              20
            </div>
            <div class="text">
              <div class="number">2회 질문 가능</div>
              <div class="money">12,000원</div>
            </div>
          </div>
          <div class="coin_box" onclick="selectCoinOption(30, 15000)">
            <div class="coin">
              <img src="{% static 'img/pupple_coin_bold.svg' %}" alt="코인아이콘" />
              30
            </div>
            <div class="text">
              <div class="number">3회 질문 가능</div>
              <div class="money">15,000원</div>
            </div>
          </div>
        </div>
        <div class="light_shadow_line"></div>
        <div class="payment_box">
          <div class="subtitle">결제수단</div>
          <div class="pay">
            <div class="indiv_agree"><input type="radio" name="payment_method" value="toss" /></div>
            <img src="{% static 'img/tosspay.png' %}" alt="토스페이" />
            토스페이
          </div>
        </div>
        <div class="thin_shadow_line"></div>
        <div class="information">
          이용안내<br />
          <span>(이용방법)</span> 코인은 ‘멘토 Q&A’에서 사용할 수 있습니다. 이용자는<br />
          콘텐츠를 구매한 계정에 로그인하여 콘텐츠를 이용하실 수 있고,<br />
          제 3자에게 계정을 양도, 대여, 매매할 수 없습니다.<br />
          <span>(결제금액)</span> 결제금액에는 부가세가 포함되어 있습니다.<br />
          <span>(환불방법)</span> 결제 후 7일 이내에 고객센터 (406-555-0120)를 통해 결제 취소가 가능합니다.<br />
          <span>(환불금액)</span> 결제 후 7일 이내에 취소하는 경우, 코인 제공량 중 남은 양이 100%일 경우 구매액의
          100%를, 100% 미만 80% 이상일 경우 구매액의 70%를, 80% 미만 50% 이상일 경우 구매액의 50%를, 50% 미만 30% 이상일
          경우 구매액의 30%를 환불하며, 30% 미만일 경우 환불이 불가합니다.
        </div>
        <button class="payment_button" onclick="requestPay()">결제하기</button>
      </div>
    </article>
    <!-- JavaScript 파일 불러오기 -->
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://cdn.iamport.kr/v1/iamport.js"></script>
    <script src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"></script>
    <script>
      IMP.init("imp02556880");

      var selectedCoinOption = 0;
      var selectedAmount = 0;

      function selectCoinOption(option, amount) {
        selectedCoinOption = option;
        selectedAmount = amount;

        // 선택된 코인 박스 스타일 변경
        var coinBoxes = document.getElementsByClassName("coin_box");
        for (var i = 0; i < coinBoxes.length; i++) {
          coinBoxes[i].classList.remove("selected");
        }
        event.currentTarget.classList.add("selected");
      }

      function requestPay() {
        if (selectedCoinOption === 0) {
          alert("코인 옵션을 선택해주세요.");
          return;
        }

        var paymentMethod = document.querySelector('input[name="payment_method"]:checked');
        var pgProvider = "tosspay"; // 기본 PG 사 (토스페이)

        if (paymentMethod) {
          if (paymentMethod.value === "naver") {
            pgProvider = "naverpay";
          } else if (paymentMethod.value === "kakao") {
            pgProvider = "kakaopay";
          }
        }

        var merchantUid = "order_no_" + new Date().getTime(); // 매번 고유한 주문번호 생성

        IMP.request_pay(
          {
            pg: pgProvider,
            pay_method: "card",
            merchant_uid: merchantUid,
            name: selectedCoinOption + "코인 구매", // 제품명 설정 예시
            amount: selectedAmount,
            buyer_email: "test@portone.io",
            buyer_name: "구매자이름",
            buyer_tel: "010-1234-5678",
            buyer_addr: "서울특별시 강남구 삼성동",
            buyer_postcode: "123-456",
            m_redirect_url: "{결제 완료 후 리디렉션 될 URL}",
          },
          function (rsp) {
            if (rsp.success) {
              alert("결제 성공");
              // 결제 성공 시 처리할 로직 추가
            } else {
              alert("결제 실패: " + rsp.error_msg);
              // 결제 실패 시 처리할 로직 추가
            }
          }
        );
      }
    </script>
    <style>
      .coin_box {
        cursor: pointer;
      }

      .coin_box.selected {
        border: 2px solid #000; /* 선택된 코인 박스에 테두리 추가 */
      }
    </style>
  </body>
</html>
